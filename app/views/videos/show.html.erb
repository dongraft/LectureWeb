<script type="text/javascript">

function embedPlayer() {
    var params = { allowScriptAccess: 'always' };
    var atts = { id: 'myytplayer' };
    swfobject.embedSWF('http://www.youtube.com/v/<%= @video.semester %>?enablejsapi=1&playerapiid=ytplayer', 
            'ytapiplayer', '809', '480', '8', null, null, params, atts);
}

function onYouTubePlayerReady(playerId) {
    ytplayer = document.getElementById('myytplayer');
    //setInterval(updateytplayerInfo, 250);
    //updateytplayerInfo();
    ytplayer.addEventListener('onStateChange', 'onytplayerStateChange');
    document.getElementById('controls').style.display = 'block';
	ytplayer.setPlaybackQuality('large');
	ytplayer.playVideo();
	
	//ytplayer.loadVideoById('<%= @video.semester %>','0');
}

function onytplayerStateChange(newState) {
     setytplayerState(newState);
}

function showVolume() {
    alert( ytplayer.getVolume() );
}

function updateytplayerInfo() {
    if (ytplayer) {
        updateTimebar();
    }
}

function updateTimebar() {
    var all = ytplayer.getDuration();
    var part = ytplayer.getCurrentTime();
    var percent = getPercent(all, part);
    var timebarWidth = 450;
    document.getElementById('timebarIndicator').style.left = percent * (timebarWidth / 100) + "px";
}

function getPercent(all, part) {
   return (all > 0) ? (100 / all) * part : 0;
}

</script>
<div id="ytapiplayer" style="display: none">(Ooops, Flash + JavaScript needed...)</div>

<div id="controls" style="display: none">
    <div id="buttons">
    </div>

    <div id="timebar">
    </div>
</div>

<p id="notice"><%= notice %></p>

<p>
  <b>Id:</b>
  <%= @video.id %>
</p>

<p>
  <b>User mail:</b>
  <%= @video.user_mail %>
</p>

<p>
  <b>Name:</b>
  <%= @video.name %>
<a href="javascript:ytplayer.seekTo('1234', 'false')">1234 segundos</a> |

</p>

<p>
  <b>Course:</b>
  <%= @video.course %>
</p>

<p>
  <b>Professor:</b>
  <%= @video.professor %>
</p>

<p>
  <b>Semester:</b>
  <%= @video.semester %>
</p>

<h2>Comentarios : </h2>

<%@video.comments.each do |c|%>
	<div class="comment">
		<p>Momento : <a href="javascript:ytplayer.seekTo('<%=c.timestamp%>', 'true')">Ir al <%=c.timestamp%> segundo</a></p>
		<p>Comentario : <%=h c.comment%></p>
	</div>
<%end%>

<%= render :partial => 'comments/form', :locals => {:video => @video }%>


<%= link_to 'Edit', edit_video_path(@video) %> |
<%= link_to 'Back', videos_path %>
